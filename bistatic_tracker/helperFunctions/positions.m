% the data used
% 1665503453,2022-10-11T15:50:53Z,EWG63X,"35.543518,24.112244",1825,159,290
% 1665503458,2022-10-11T15:50:58Z,EWG63X,"35.545101,24.107159",1950,165,290
% 1665503465,2022-10-11T15:51:05Z,EWG63X,"35.546768,24.101543",2050,172,290
% 1665503470,2022-10-11T15:51:10Z,EWG63X,"35.548508,24.095993",2175,179,290
% 1665503477,2022-10-11T15:51:17Z,EWG63X,"35.55064,24.089102",2300,188,290
% 1665503482,2022-10-11T15:51:22Z,EWG63X,"35.552261,24.083862",2400,194,291
% 1665503489,2022-10-11T15:51:29Z,EWG63X,"35.554367,24.077168",2500,204,290
% 1665503495,2022-10-11T15:51:35Z,EWG63X,"35.556656,24.069729",2600,214,291
% 1665503501,2022-10-11T15:51:41Z,EWG63X,"35.558853,24.062634",2725,223,290
% 1665503507,2022-10-11T15:51:47Z,EWG63X,"35.561005,24.05571",2975,226,290
% 1665503514,2022-10-11T15:51:54Z,EWG63X,"35.563705,24.047928",3375,225,294
% 1665503516,2022-10-11T15:51:56Z,EWG63X,"35.565262,24.044724",3550,224,299
% 1665503519,2022-10-11T15:51:59Z,EWG63X,"35.567047,24.041748",3700,225,305
% 1665503523,2022-10-11T15:52:03Z,EWG63X,"35.56926,24.038729",3875,226,311
% 1665503525,2022-10-11T15:52:05Z,EWG63X,"35.571487,24.036369",4025,227,318
% 1665503529,2022-10-11T15:52:09Z,EWG63X,"35.574383,24.033878",4200,227,324

% 1664985338,2022-10-05T15:55:38Z,EWG1Z,"35.531368,24.150988",225,125,292
% 1664985344,2022-10-05T15:55:44Z,EWG1Z,"35.532852,24.146461",150,147,292
% 1664985350,2022-10-05T15:55:50Z,EWG1Z,"35.534439,24.141579",300,160,291
% 1664985356,2022-10-05T15:55:56Z,EWG1Z,"35.536148,24.136105",525,158,291
% 1664985362,2022-10-05T15:56:02Z,EWG1Z,"35.537659,24.131241",750,157,290
% 1664985370,2022-10-05T15:56:10Z,EWG1Z,"35.539608,24.124807",1050,157,290
% 1664985376,2022-10-05T15:56:16Z,EWG1Z,"35.541191,24.119549",1325,159,289
% 1664985381,2022-10-05T15:56:21Z,EWG1Z,"35.542496,24.115166",1575,157,290
% 1664985388,2022-10-05T15:56:28Z,EWG1Z,"35.544075,24.110023",1750,162,290
% 1664985394,2022-10-05T15:56:34Z,EWG1Z,"35.545944,24.104004",1925,169,290
% 1664985400,2022-10-05T15:56:40Z,EWG1Z,"35.547638,24.098682",2075,175,291
% 1664985406,2022-10-05T15:56:46Z,EWG1Z,"35.549606,24.092388",2225,187,290
% 1664985412,2022-10-05T15:56:52Z,EWG1Z,"35.551384,24.086647",2400,195,290
% 1664985418,2022-10-05T15:56:58Z,EWG1Z,"35.553452,24.080086",2525,203,291
% 1664985424,2022-10-05T15:57:04Z,EWG1Z,"35.55574,24.07259",2675,214,290
% 1664985430,2022-10-05T15:57:10Z,EWG1Z,"35.557949,24.065493",2875,222,290
% 1664985436,2022-10-05T15:57:16Z,EWG1Z,"35.560555,24.058247",3075,225,295
% 1664985439,2022-10-05T15:57:19Z,EWG1Z,"35.562103,24.055138",3150,226,301
% 1664985442,2022-10-05T15:57:22Z,EWG1Z,"35.56398,24.052162",3275,226,305
% 1664985445,2022-10-05T15:57:25Z,EWG1Z,"35.565865,24.049774",3400,223,314
% 1664985449,2022-10-05T15:57:29Z,EWG1Z,"35.568878,24.046726",3600,221,320
% 1664985451,2022-10-05T15:57:31Z,EWG1Z,"35.571308,24.044865",3750,218,327
% 1664985454,2022-10-05T15:57:34Z,EWG1Z,"35.574005,24.043236",3950,215,334
% 1664985457,2022-10-05T15:57:37Z,EWG1Z,"35.576843,24.042091",4125,213,341
% 1664985461,2022-10-05T15:57:41Z,EWG1Z,"35.579819,24.04129",4300,211,347
% 1664985463,2022-10-05T15:57:43Z,EWG1Z,"35.582611,24.040947",4475,210,354
% 1664985466,2022-10-05T15:57:46Z,EWG1Z,"35.585449,24.040947",4625,209,354
% 1664985469,2022-10-05T15:57:49Z,EWG1Z,"35.588242,24.041233",4800,209,3
% 1664985473,2022-10-05T15:57:53Z,EWG1Z,"35.591583,24.041748",4975,209,6
% 1664985476,2022-10-05T15:57:56Z,EWG1Z,"35.594494,24.042234",5150,208,7
% 1664985479,2022-10-05T15:57:59Z,EWG1Z,"35.59726,24.042721",5300,209,7
% 1664985482,2022-10-05T15:58:02Z,EWG1Z,"35.600052,24.043179",5450,209,7
% 1664985485,2022-10-05T15:58:05Z,EWG1Z,"35.603302,24.043751",5625,209,7
% 1664985488,2022-10-05T15:58:08Z,EWG1Z,"35.606003,24.044209",5775,209,7
% 1664985491,2022-10-05T15:58:11Z,EWG1Z,"35.608978,24.044724",5925,210,7
% 1664985494,2022-10-05T15:58:14Z,EWG1Z,"35.611671,24.045156",6075,210,7
% 1664985497,2022-10-05T15:58:17Z,EWG1Z,"35.61451,24.045624",6200,210,7
% 1664985509,2022-10-05T15:58:29Z,EWG1Z,"35.626194,24.047611",6800,211,7
% 1664985521,2022-10-05T15:58:41Z,EWG1Z,"35.638367,24.049587",7325,216,7
% 1664985533,2022-10-05T15:58:53Z,EWG1Z,"35.650124,24.049599",7800,221,353
% 1664985536,2022-10-05T15:58:56Z,EWG1Z,"35.653427,24.048557",7925,222,347
% 1664985539,2022-10-05T15:58:59Z,EWG1Z,"35.656448,24.047241",8075,223,340
% 1664985542,2022-10-05T15:59:02Z,EWG1Z,"35.659332,24.045467",8200,225,334
% 1664985545,2022-10-05T15:59:05Z,EWG1Z,"35.661942,24.043465",8275,228,329
% 1664985548,2022-10-05T15:59:08Z,EWG1Z,"35.664692,24.041124",8375,231,325
% 1664985551,2022-10-05T15:59:11Z,EWG1Z,"35.667114,24.038887",8475,236,323
% 1664985554,2022-10-05T15:59:14Z,EWG1Z,"35.669861,24.036312",8550,239,322
% 1664985557,2022-10-05T15:59:17Z,EWG1Z,"35.672699,24.033587",8650,242,321
% 1664985560,2022-10-05T15:59:20Z,EWG1Z,"35.6754,24.030933",8725,247,321
% 1664985563,2022-10-05T15:59:23Z,EWG1Z,"35.678101,24.028269",8825,250,321
% 1664985566,2022-10-05T15:59:26Z,EWG1Z,"35.68071,24.025726",8875,254,321
% 1664985569,2022-10-05T15:59:29Z,EWG1Z,"35.683918,24.022657",8975,259,321
% 1664985572,2022-10-05T15:59:32Z,EWG1Z,"35.686523,24.020119",9050,262,321
% 1664985584,2022-10-05T15:59:44Z,EWG1Z,"35.698288,24.008846",9525,270,322
% 1664985596,2022-10-05T15:59:56Z,EWG1Z,"35.71022,23.99753",10225,271,322
% 1664985608,2022-10-05T16:00:08Z,EWG1Z,"35.722641,23.985729",10525,286,322

%% SEH2CQ
% 1667286180,2022-11-01T07:03:00Z,SEH2CQ,"35.528549,24.159565",250,113,291
% 1667286186,2022-11-01T07:03:06Z,SEH2CQ,"35.529877,24.155674",275,129,292
% 1667286192,2022-11-01T07:03:12Z,SEH2CQ,"35.531433,24.151211",375,136,292
% 1667286198,2022-11-01T07:03:18Z,SEH2CQ,"35.532997,24.146605",575,133,292
% 1667286204,2022-11-01T07:03:24Z,SEH2CQ,"35.534393,24.142691",800,127,293
% 1667286211,2022-11-01T07:03:31Z,SEH2CQ,"35.535828,24.138451",1050,124,292
% 1667286219,2022-11-01T07:03:39Z,SEH2CQ,"35.537605,24.133339",1325,120,294
% 1667286225,2022-11-01T07:03:45Z,SEH2CQ,"35.539001,24.129482",1500,122,294
% 1667286232,2022-11-01T07:03:52Z,SEH2CQ,"35.540588,24.125118",1650,125,292
% 1667286238,2022-11-01T07:03:58Z,SEH2CQ,"35.542007,24.121113",1700,134,293
% 1667286244,2022-11-01T07:04:04Z,SEH2CQ,"35.54361,24.116686",1775,141,294
% 1667286250,2022-11-01T07:04:10Z,SEH2CQ,"35.545193,24.112303",1825,149,293
% 1667286256,2022-11-01T07:04:16Z,SEH2CQ,"35.546951,24.107323",1900,158,293
% 1667286262,2022-11-01T07:04:22Z,SEH2CQ,"35.548737,24.10223",2000,163,293
% 1667286268,2022-11-01T07:04:28Z,SEH2CQ,"35.550686,24.096874",2025,171,293
% 1667286274,2022-11-01T07:04:34Z,SEH2CQ,"35.552689,24.091265",2175,171,293
% 1667286280,2022-11-01T07:04:40Z,SEH2CQ,"35.554642,24.085693",2350,170,293
% 1667286288,2022-11-01T07:04:48Z,SEH2CQ,"35.557068,24.078712",2525,172,293
% 1667286295,2022-11-01T07:04:55Z,SEH2CQ,"35.559082,24.073105",2675,174,292
% 1667286301,2022-11-01T07:05:01Z,SEH2CQ,"35.56105,24.06744",2800,175,293
% 1667286306,2022-11-01T07:05:06Z,SEH2CQ,"35.562836,24.062347",2950,175,293
% 1667286312,2022-11-01T07:05:12Z,SEH2CQ,"35.56485,24.05674",3100,175,294
% 1667286316,2022-11-01T07:05:16Z,SEH2CQ,"35.566223,24.053535",3175,175,299
% 1667286319,2022-11-01T07:05:19Z,SEH2CQ,"35.567413,24.051418",3250,173,307
% 1667286321,2022-11-01T07:05:21Z,SEH2CQ,"35.568981,24.049364",3300,172,313
% 1667286325,2022-11-01T07:05:25Z,SEH2CQ,"35.570892,24.047552",3375,169,324
% 1667286328,2022-11-01T07:05:28Z,SEH2CQ,"35.572998,24.046097",3475,166,334
% 1667286331,2022-11-01T07:05:31Z,SEH2CQ,"35.575081,24.045156",3550,166,341
% 1667286334,2022-11-01T07:05:34Z,SEH2CQ,"35.577667,24.044552",3600,166,351
% 1667286337,2022-11-01T07:05:37Z,SEH2CQ,"35.580002,24.044323",3675,167,357
% 1667286340,2022-11-01T07:05:40Z,SEH2CQ,"35.581505,24.044338",3700,167,2
% 1667286343,2022-11-01T07:05:43Z,SEH2CQ,"35.584625,24.044552",3800,167,3
% 1667286346,2022-11-01T07:05:46Z,SEH2CQ,"35.586998,24.044748",3850,168,4
% 1667286349,2022-11-01T07:05:49Z,SEH2CQ,"35.589279,24.044865",3900,169,3
% 1667286350,2022-11-01T07:05:50Z,SEH2CQ,"35.590027,24.044895",3925,170,1
% 1667286354,2022-11-01T07:05:54Z,SEH2CQ,"35.592957,24.044724",4000,171,354
% 1667286357,2022-11-01T07:05:57Z,SEH2CQ,"35.595238,24.044397",4075,171,352
% 1667286360,2022-11-01T07:06:00Z,SEH2CQ,"35.597626,24.044037",4125,172,352
% 1667286366,2022-11-01T07:06:06Z,SEH2CQ,"35.602268,24.043287",4250,173,352
% 1667286368,2022-11-01T07:06:08Z,SEH2CQ,"35.60463,24.042892",4325,173,352
% 1667286371,2022-11-01T07:06:11Z,SEH2CQ,"35.607155,24.04241",4400,173,351
% 1667286375,2022-11-01T07:06:15Z,SEH2CQ,"35.609715,24.042002",4475,173,351
% 1667286377,2022-11-01T07:06:17Z,SEH2CQ,"35.611763,24.041651",4525,173,351
% 1667286381,2022-11-01T07:06:21Z,SEH2CQ,"35.6147,24.041119",4600,174,351
% 1667286387,2022-11-01T07:06:27Z,SEH2CQ,"35.6194,24.040306",4750,174,352
%% EWG63X
% plane_data=[35.543518,24.112244,1825,159,290;
%     35.545101,24.107159,1950,165,290;
% 35.546768,24.101543,2050,172,290;
% 35.548508,24.095993,2175,179,290;
% 35.55064,24.089102,2300,188,290;
% 35.552261,24.083862,2400,194,291;
% 35.554367,24.077168,2500,204,290;
% 35.556656,24.069729,2600,214,291;
% 35.558853,24.062634,2725,223,290;
% 35.561005,24.05571,2975,226,290;
% 35.563705,24.047928,3375,225,294;
% 35.565262,24.044724,3550,224,299;
% 35.567047,24.041748,3700,225,305;
% 35.56926,24.038729,3875,226,311;
% 35.571487,24.036369,4025,227,318;
% 35.574383,24.033878,4200,227,324;];
t=[6 12 18 24 31 39 45 52 58 64 70 76 82 88 94 100 108  115 121 126 132 136 139 141 145 148 151 154 157 160 163 166 169 170 174 177 180 186 188 191 195 197 201 207]-6; 
plane_data=[35.528549,24.159565,250;
35.529877,24.155674,275;
35.531433,24.151211,375;
35.532997,24.146605,575;
35.534393,24.142691,800;
35.535828,24.138451,1050;
35.537605,24.133339,1325;
35.539001,24.129482,1500;
35.540588,24.125118,1650;
35.542007,24.121113,1700;
35.54361,24.116686,1775;
35.545193,24.112303,1825;
35.546951,24.107323,1900;
35.548737,24.10223,2000;
35.550686,24.096874,2025;
35.552689,24.091265,2175;
35.554642,24.085693,2350;
35.557068,24.078712,2525;
35.559082,24.073105,2675;
35.56105,24.06744,2800;
35.562836,24.062347,2950;
35.56485,24.05674,3100;
35.566223,24.053535,3175;
35.567413,24.051418,3250;
35.568981,24.049364,3300;
35.570892,24.047552,3375;
35.572998,24.046097,3475;
35.575081,24.045156,3550;
35.577667,24.044552,3600;
35.580002,24.044323,3675;
35.581505,24.044338,3700;
35.584625,24.044552,3800;
35.586998,24.044748,3850;
35.589279,24.044865,3900;
35.590027,24.044895,3925;
35.592957,24.044724,4000;
35.595238,24.044397,4075;
35.597626,24.044037,4125;
35.602268,24.043287,4250;
35.60463,24.042892,4325;
35.607155,24.04241,4400;
35.609715,24.042002,4475;
35.611763,24.041651,4525;
35.6147,24.041119,4600;
35.6194,24.040306,4750];



% plane_data=[
% 35.531368,24.150988,225;
% 35.532852,24.146461,150;
% 35.534439,24.141579,300;
% 35.536148,24.136105,525;
% 35.537659,24.131241,750;
% 35.539608,24.124807,1050;
% 35.541191,24.119549,1325;
% 35.542496,24.115166,1575;
% 35.544075,24.110023,1750;
% 35.545944,24.104004,1925;
% 35.547638,24.098682,2075;
% 35.549606,24.092388,2225;
% 35.551384,24.086647,2400;
% 35.553452,24.080086,2525;
% 35.55574,24.07259,2675;
% 35.557949,24.065493,2875;
% 35.560555,24.058247,3075;
% 35.562103,24.055138,3150;
% 35.56398,24.052162,3275;
% 35.565865,24.049774,3400;
% 35.568878,24.046726,3600;
% 35.571308,24.044865,3750;
% 35.574005,24.043236,3950;
% 35.576843,24.042091,4125;
% 35.579819,24.04129,4300;
% 35.582611,24.040947,4475;
% 35.585449,24.040947,4625;
% 35.588242,24.041233,4800;
% 35.591583,24.041748,4975;
% 35.594494,24.042234,5150;
% 35.59726,24.042721,5300;
% 35.600052,24.043179,5450;
% 35.603302,24.043751,5625;
% 35.606003,24.044209,5775;
% 35.608978,24.044724,5925;
% 35.611671,24.045156,6075;
% 35.61451,24.045624,6200;
% 35.626194,24.047611,6800;
% 35.638367,24.049587,7325;
% 35.650124,24.049599,7800;
% 35.653427,24.048557,7925;
% 35.656448,24.047241,8075;
% 35.659332,24.045467,8200;
% 35.661942,24.043465,8275;
% 35.664692,24.041124,8375;
% 35.667114,24.038887,8475;
% 35.669861,24.036312,8550;
% 35.672699,24.033587,8650;
% 35.6754,24.030933,8725;
% 35.678101,24.028269,8825;
% 35.68071,24.025726,8875;
% 35.683918,24.022657,8975;
% 35.686523,24.020119,9050;
% 35.698288,24.008846,9525];
% t=[6 12 18 24 32 38 43 50 56 62 68 74 80 86 92 98 101 104 107 111 113 116 119 123 125 128 131 135 138 141 144 147 150 153 157 160 163 175 187 190 193 196 199 202 205 208 211 214 217 220 223 226 238]-6;

%% EWG1Z
% plane_data=[35.549606,24.092388,2225;
% 35.551384,24.086647,2400;
% 35.553452,24.080086,2525;
% 35.55574,24.07259,2675;
% 35.557949,24.065493,2875;
% 35.560555,24.058247,3075;
% 35.562103,24.055138,3150;
% 35.56398,24.052162,3275;
% 35.565865,24.049774,3400;
% 35.568878,24.046726,3600;
% 35.571308,24.044865,3750;
% 35.574005,24.043236,3950;
% 35.576843,24.042091,4125;
% 35.579819,24.04129,4300;
% 35.582611,24.040947,4475;
% 35.585449,24.040947,4625;
% 35.588242,24.041233,4800;
% 35.591583,24.041748,4975;
% 35.594494,24.042234,5150;
% 35.59726,24.042721,5300;
% 35.600052,24.043179,5450;
% 35.603302,24.043751,5625;
% 35.606003,24.044209,5775];
% t=[-12 -6 0 6 12 15 18 21 25 27 30 33 37 39 42 45 49 52 55 58 61 64];
% tuc
tx_lat=dms2degrees([35 31 54.89]);
tx_lon=dms2degrees([24 4 6.14]);
tx_height=111;
origin=[tx_lat tx_lon tx_height];
[tx_x,tx_y,tx_z]=latlon2local(tx_lat,tx_lon,tx_height,origin);
stem(gca, tx_x, tx_y,'Color','black','LineStyle','none')
hold on



% malaxa
% 35.5067524312666, 23.744299087504942
rx1_lat=dms2degrees([35 28 1.05]);
rx1_lon=dms2degrees([24 4 46.57]);
rx1_alt=640;
[rx1_x,rx1_y,rx1_z]=latlon2local(rx1_lat,rx1_lon,rx1_alt,origin);
stem(gca, rx1_x, rx1_y,'Color','black','LineStyle','none')
hold on

%skloka
% skloka-tuc = 9.7586e+03
rx3_lat=dms2degrees([35 32 59.47]);
rx3_lon=dms2degrees([24 10 24.86]);
rx3_alt=610;
[rx2_x,rx2_y,rx2_z]=latlon2local(rx3_lat,rx3_lon,rx3_alt,origin);
stem(gca, rx2_x, rx2_y,'Color','black','LineStyle','none')
hold on
axis('equal');
% souda
%35.484645351073155, 24.074499541866643
rx2_lat=35.484645351073155;
rx2_lon=24.074499541866643;
rx2_alt=120;
[rx3_x,rx3_y,rx3_z]=latlon2local(rx2_lat,rx2_lon,rx2_alt,origin);
stem(gca, rx3_x, rx3_y,'Color','black','LineStyle','none')
hold on

% plane coordinates to local and speed
coordinates=[plane_data(:,1) plane_data(:,2)];
altitude=distdim(plane_data(:,3),'ft','m');
% speed=plane_data(2:end,4)* 0.51444; % knots to m/s
% direction=plane_data(2:end,5);
[plane_x,plane_y,plane_z]=latlon2local(coordinates(:,1),coordinates(:,2),altitude,origin);
% theta=min([abs(360-direction),abs(180-direction),abs(0-direction)],[],2);
% x_speed=speed.*sind(theta);
% y_speed=speed.*cosd(theta);
% t=[0 7 12 19 24 31 37 43 49 56 58 61 65 67 71 ];
% z_speed=zeros(size(x_speed));
plane_x0=plane_x(1);
plane_y0=plane_y(1);
plane_z0=plane_z(1);
plane_x=plane_x(2:end,:);
plane_y=plane_y(2:end,:);
plane_z=plane_z(2:end,:);
t0=-6;
x_speed(1)=(plane_x(1)-plane_x0)/(t(1)-t0);
y_speed(1)=(plane_y(1)-plane_y0)/(t(1)-t0);
z_speed(1)=(plane_z(1)-plane_z0)/(t(1)-t0);
for k=1:size(plane_z,1)-1
    x_speed(k+1)=(plane_x(k+1)-plane_x(k))/(t(k+1)-t(k));
    y_speed(k+1)=(plane_y(k+1)-plane_y(k))/(t(k+1)-t(k));
    z_speed(k+1)=(plane_z(k+1)-plane_z(k))/(t(k+1)-t(k));
end
data_per_CPI
stem(gca, plane_x, plane_y,'Color','r','LineStyle','none')
hold on
axis('equal');
figure()
subplot(3,1,1)
plot(t,x_speed)
title("x speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")
subplot(3,1,2)
plot(t,y_speed)
title("y speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")
subplot(3,1,3)
plot(t,z_speed)
title("z speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")


figure()
subplot(3,1,1)
plot(t,plane_x)
title("x speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")
subplot(3,1,2)
plot(t,plane_y)
title("y speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")
subplot(3,1,3)
plot(t,plane_z)
title("z speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")

figure()
subplot(3,1,1)
plot([1:112],plane_x_interp)
title("x speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")
subplot(3,1,2)
plot([1:112],plane_y_interp)
title("y speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")
subplot(3,1,3)
plot([1:112],plane_z_interp)
title("z speed (m/s)")
xlabel("Time (sec)")
ylabel("Speed (m/s)")